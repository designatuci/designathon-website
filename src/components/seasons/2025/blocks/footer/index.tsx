"use client";

import { cn } from "@/lib/utils";
import {
  useMotionValueEvent,
  useScroll,
  useSpring,
  useTransform,
} from "motion/react";
import Link from "next/link";
import { useCallback, useEffect, useRef, useState } from "react";

const NUM_FRAMES = 26;

function Footer() {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const sectionRef = useRef<HTMLDivElement>(null);

  const { scrollYProgress } = useScroll({
    target: sectionRef,
    offset: ["20% end", "70% end"],
  });

  const [cachedImages, setCachedImages] = useState<HTMLImageElement[]>([]);

  useEffect(() => {
    const loadedImages: HTMLImageElement[] = [];

    let numImagesLoaded = 0;

    for (let i = 1; i <= NUM_FRAMES; i++) {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.src = `/images/seasons/2025/landing/footer/${i}.webp`;

      loadedImages.push(img);

      img.onload = () => {
        numImagesLoaded++;

        if (numImagesLoaded === NUM_FRAMES) {
          setCachedImages(loadedImages);
        }
      };
    }
  }, []);

  const renderFrame = useCallback(
    (index: number) => {
      if (!canvasRef.current) return;

      const ctx = canvasRef.current.getContext("2d");

      if (!ctx) return;

      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);

      if (cachedImages[index - 1]) {
        ctx.drawImage(cachedImages[index - 1], 0, 0, 1920, 2500);
      }
    },
    [cachedImages],
  );

  const scrollYSpring = useSpring(scrollYProgress, {
    stiffness: 250,
    damping: 50,
  });

  const currentIndex = useTransform(scrollYSpring, [0, 1], [13, NUM_FRAMES]);

  useMotionValueEvent(currentIndex, "change", (latest) => {
    renderFrame(Number(latest.toFixed()));
  });

  useEffect(() => {
    if (!cachedImages.length) return;

    renderFrame(13);
  }, [cachedImages.length, renderFrame]);

  return (
    <section
      className="flex items-start justify-center overflow-hidden bg-(--blue)"
      ref={sectionRef}
    >
      <div
        className={cn(
          "relative flex w-full flex-grow items-center justify-center overflow-hidden mask-top",
        )}
      >
        <canvas
          className="h-full w-full object-cover object-bottom 3xl:!h-[2500px] 3xl:object-top"
          width={1920}
          height={2500}
          ref={canvasRef}
        />
        <div className="absolute bottom-0 left-1/2 flex w-full -translate-x-1/2 flex-col items-center gap-2 px-4 pb-12 text-center">
          <div className="flex gap-1 text-lg font-bold text-(--blue) [&_a]:underline">
            {/* TODO: add URL */}
            <Link
              href="https://forms.gle/BNWnN8dSJR9kqwjC8"
              target="_blank"
              rel="noopener noreferrer"
            >
              Apply
            </Link>
            <span>·</span>
            {/* TODO: add URL */}
            <Link
              href="https://drive.google.com/file/d/1EgxZHXxWWubHn-ZiM4X4ZAQSlCJoYS84/view"
              target="_blank"
              rel="noopener noreferrer"
            >
              Sponsor Us
            </Link>
          </div>
          <div className="flex items-center gap-3">
            {socialItems.map((item, index) => (
              <Link
                key={index}
                href={item.href}
                target="_blank"
                rel="noopener noreferrer"
              >
                <span className="block *:size-6">{item.icon}</span>
              </Link>
            ))}
          </div>
          <div className="flex font-bold text-(--blue)">
            <p>
              &copy; 2025 Design at UCI • Made with &#128149; by UCI Designathon
            </p>
          </div>
        </div>
      </div>
    </section>
  );
}

export default Footer;

interface SocialItem {
  icon: React.ReactNode;
  href: string;
}

const socialItems: SocialItem[] = [
  {
    icon: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="42"
        height="42"
        viewBox="0 0 42 42"
        fill="none"
      >
        <path
          d="M12.0833 0.166016H29.5833C36.25 0.166016 41.6667 5.58268 41.6667 12.2493V29.7493C41.6667 32.954 40.3936 36.0275 38.1275 38.2936C35.8615 40.5596 32.788 41.8327 29.5833 41.8327H12.0833C5.41667 41.8327 0 36.416 0 29.7493V12.2493C0 9.04465 1.27306 5.97121 3.53913 3.70514C5.80519 1.43908 8.87863 0.166016 12.0833 0.166016ZM11.6667 4.33268C9.67754 4.33268 7.76989 5.12286 6.36337 6.52938C4.95684 7.9359 4.16667 9.84356 4.16667 11.8327V30.166C4.16667 34.3118 7.52083 37.666 11.6667 37.666H30C31.9891 37.666 33.8968 36.8758 35.3033 35.4693C36.7098 34.0628 37.5 32.1551 37.5 30.166V11.8327C37.5 7.68685 34.1458 4.33268 30 4.33268H11.6667ZM31.7708 7.45768C32.4615 7.45768 33.1239 7.73205 33.6123 8.22042C34.1006 8.7088 34.375 9.37118 34.375 10.0618C34.375 10.7525 34.1006 11.4149 33.6123 11.9033C33.1239 12.3916 32.4615 12.666 31.7708 12.666C31.0802 12.666 30.4178 12.3916 29.9294 11.9033C29.441 11.4149 29.1667 10.7525 29.1667 10.0618C29.1667 9.37118 29.441 8.7088 29.9294 8.22042C30.4178 7.73205 31.0802 7.45768 31.7708 7.45768ZM20.8333 10.5827C23.596 10.5827 26.2455 11.6801 28.199 13.6337C30.1525 15.5872 31.25 18.2367 31.25 20.9993C31.25 23.762 30.1525 26.4115 28.199 28.365C26.2455 30.3185 23.596 31.416 20.8333 31.416C18.0707 31.416 15.4211 30.3185 13.4676 28.365C11.5141 26.4115 10.4167 23.762 10.4167 20.9993C10.4167 18.2367 11.5141 15.5872 13.4676 13.6337C15.4211 11.6801 18.0707 10.5827 20.8333 10.5827ZM20.8333 14.7493C19.1757 14.7493 17.586 15.4078 16.4139 16.5799C15.2418 17.752 14.5833 19.3417 14.5833 20.9993C14.5833 22.657 15.2418 24.2467 16.4139 25.4188C17.586 26.5909 19.1757 27.2493 20.8333 27.2493C22.4909 27.2493 24.0806 26.5909 25.2528 25.4188C26.4249 24.2467 27.0833 22.657 27.0833 20.9993C27.0833 19.3417 26.4249 17.752 25.2528 16.5799C24.0806 15.4078 22.4909 14.7493 20.8333 14.7493Z"
          fill="#354F99"
        />
      </svg>
    ),
    href: "https://www.instagram.com/ucidesignathon/",
  },
  {
    icon: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="51"
        height="50"
        viewBox="0 0 51 50"
        fill="none"
      >
        <path
          d="M40.8085 11.1009C38.0377 9.80924 35.0377 8.87174 31.9127 8.33008C31.8577 8.33086 31.8053 8.35333 31.7668 8.39258C31.3918 9.08008 30.9543 9.97591 30.6627 10.6634C27.3481 10.1637 23.9773 10.1637 20.6627 10.6634C20.371 9.95508 19.9335 9.08008 19.5377 8.39258C19.5168 8.35091 19.4543 8.33008 19.3918 8.33008C16.2668 8.87174 13.2877 9.80924 10.496 11.1009C10.4752 11.1009 10.4543 11.1217 10.4335 11.1426C4.76685 19.6217 3.20435 27.8717 3.97518 36.0384C3.97518 36.0801 3.99601 36.1217 4.03768 36.1426C7.78768 38.8926 11.3918 40.5592 14.9543 41.6634C15.0168 41.6842 15.0793 41.6634 15.1002 41.6217C15.9335 40.4759 16.6835 39.2676 17.3293 37.9967C17.371 37.9134 17.3293 37.8301 17.246 37.8092C16.0585 37.3509 14.9335 36.8092 13.8293 36.1842C13.746 36.1426 13.746 36.0176 13.8085 35.9551C14.0377 35.7884 14.2668 35.6009 14.496 35.4342C14.5377 35.3926 14.6002 35.3926 14.6418 35.4134C21.8085 38.6842 29.5377 38.6842 36.621 35.4134C36.6627 35.3926 36.7252 35.3926 36.7668 35.4342C36.996 35.6217 37.2252 35.7884 37.4543 35.9759C37.5377 36.0384 37.5377 36.1634 37.4335 36.2051C36.3502 36.8509 35.2043 37.3717 34.0168 37.8301C33.9335 37.8509 33.9127 37.9551 33.9335 38.0176C34.6002 39.2884 35.3502 40.4967 36.1627 41.6426C36.2252 41.6634 36.2877 41.6842 36.3502 41.6634C39.9335 40.5592 43.5377 38.8926 47.2877 36.1426C47.3293 36.1217 47.3502 36.0801 47.3502 36.0384C48.2668 26.6009 45.8293 18.4134 40.8918 11.1426C40.871 11.1217 40.8502 11.1009 40.8085 11.1009ZM18.4127 31.0592C16.2668 31.0592 14.4752 29.0801 14.4752 26.6426C14.4752 24.2051 16.2252 22.2259 18.4127 22.2259C20.621 22.2259 22.371 24.2259 22.3502 26.6426C22.3502 29.0801 20.6002 31.0592 18.4127 31.0592ZM32.9335 31.0592C30.7877 31.0592 28.996 29.0801 28.996 26.6426C28.996 24.2051 30.746 22.2259 32.9335 22.2259C35.1418 22.2259 36.8918 24.2259 36.871 26.6426C36.871 29.0801 35.1418 31.0592 32.9335 31.0592Z"
          fill="#354F99"
        />
      </svg>
    ),
    href: "https://discord.com/invite/MBVrKe9",
  },
  {
    icon: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="51"
        height="50"
        viewBox="0 0 51 50"
        fill="none"
      >
        <path
          d="M21.5016 31.2474L32.3141 24.9974L21.5016 18.7474V31.2474ZM45.585 14.9349C45.8558 15.9141 46.0433 17.2266 46.1683 18.8932C46.3141 20.5599 46.3766 21.9974 46.3766 23.2474L46.5016 24.9974C46.5016 29.5599 46.1683 32.9141 45.585 35.0599C45.0641 36.9349 43.8558 38.1432 41.9808 38.6641C41.0016 38.9349 39.21 39.1224 36.46 39.2474C33.7516 39.3932 31.2725 39.4557 28.9808 39.4557L25.6683 39.5807C16.9391 39.5807 11.5016 39.2474 9.35579 38.6641C7.48079 38.1432 6.27246 36.9349 5.75163 35.0599C5.48079 34.0807 5.29329 32.7682 5.16829 31.1016C5.02246 29.4349 4.95996 27.9974 4.95996 26.7474L4.83496 24.9974C4.83496 20.4349 5.16829 17.0807 5.75163 14.9349C6.27246 13.0599 7.48079 11.8516 9.35579 11.3307C10.335 11.0599 12.1266 10.8724 14.8766 10.7474C17.585 10.6016 20.0641 10.5391 22.3558 10.5391L25.6683 10.4141C34.3975 10.4141 39.835 10.7474 41.9808 11.3307C43.8558 11.8516 45.0641 13.0599 45.585 14.9349Z"
          fill="#354F99"
        />
      </svg>
    ),
    href: "https://www.youtube.com/channel/UC3LqXqBN-R7C91ttlyXHhIQ",
  },
  {
    icon: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="51"
        height="50"
        viewBox="0 0 51 50"
        fill="none"
      >
        <path
          d="M40.2511 6.25C41.3561 6.25 42.4159 6.68899 43.1973 7.47039C43.9787 8.25179 44.4177 9.3116 44.4177 10.4167V39.5833C44.4177 40.6884 43.9787 41.7482 43.1973 42.5296C42.4159 43.311 41.3561 43.75 40.2511 43.75H11.0844C9.97932 43.75 8.91951 43.311 8.13811 42.5296C7.35671 41.7482 6.91772 40.6884 6.91772 39.5833V10.4167C6.91772 9.3116 7.35671 8.25179 8.13811 7.47039C8.91951 6.68899 9.97932 6.25 11.0844 6.25H40.2511ZM39.2094 38.5417V27.5C39.2094 25.6987 38.4938 23.9712 37.2202 22.6976C35.9465 21.4239 34.219 20.7083 32.4177 20.7083C30.6469 20.7083 28.5844 21.7917 27.5844 23.4167V21.1042H21.7719V38.5417H27.5844V28.2708C27.5844 26.6667 28.8761 25.3542 30.4802 25.3542C31.2538 25.3542 31.9956 25.6615 32.5426 26.2084C33.0896 26.7554 33.3969 27.4973 33.3969 28.2708V38.5417H39.2094ZM15.0011 17.8333C15.9293 17.8333 16.8196 17.4646 17.4759 16.8082C18.1323 16.1518 18.5011 15.2616 18.5011 14.3333C18.5011 12.3958 16.9386 10.8125 15.0011 10.8125C14.0673 10.8125 13.1717 11.1834 12.5115 11.8437C11.8512 12.504 11.4802 13.3995 11.4802 14.3333C11.4802 16.2708 13.0636 17.8333 15.0011 17.8333ZM17.8969 38.5417V21.1042H12.1261V38.5417H17.8969Z"
          fill="#354F99"
        />
      </svg>
    ),
    href: "https://www.linkedin.com/company/design-at-uci",
  },
  {
    icon: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="51"
        height="50"
        viewBox="0 0 51 50"
        fill="none"
      >
        <path
          d="M46.5019 24.9993C46.5019 13.4993 37.1685 4.16602 25.6685 4.16602C14.1685 4.16602 4.83521 13.4993 4.83521 24.9993C4.83521 35.0827 12.0019 43.4785 21.5019 45.416V31.2493H17.3352V24.9993H21.5019V19.791C21.5019 15.7702 24.7727 12.4993 28.7935 12.4993H34.0019V18.7493H29.8352C28.6894 18.7493 27.7519 19.6868 27.7519 20.8327V24.9993H34.0019V31.2493H27.7519V45.7285C38.2727 44.6868 46.5019 35.8118 46.5019 24.9993Z"
          fill="#354F99"
        />
      </svg>
    ),
    href: "https://www.facebook.com/designatuci/",
  },
  {
    icon: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="51"
        height="50"
        viewBox="0 0 51 50"
        fill="none"
      >
        <path
          d="M35.2499 12.127C33.8261 10.501 33.0414 8.4132 33.0416 6.25195H26.6041V32.0853C26.5555 33.4836 25.9656 34.8084 24.9589 35.7801C23.9522 36.7518 22.6074 37.2945 21.2083 37.2936C18.2499 37.2936 15.7916 34.8769 15.7916 31.8769C15.7916 28.2936 19.2499 25.6061 22.8124 26.7103V20.127C15.6249 19.1686 9.33325 24.752 9.33325 31.8769C9.33325 38.8144 15.0833 43.7519 21.1874 43.7519C27.7291 43.7519 33.0416 38.4394 33.0416 31.8769V18.7728C35.652 20.6475 38.7861 21.6533 41.9999 21.6478V15.2103C41.9999 15.2103 38.0833 15.3978 35.2499 12.127Z"
          fill="#354F99"
        />
      </svg>
    ),
    href: "https://www.tiktok.com/@design_at_uci",
  },
];
